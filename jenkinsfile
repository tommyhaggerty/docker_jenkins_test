pipeline {
   agent { node 'Mac' } 
   triggers { pollSCM('* * * * *')}

   stages {
      stage('Build') {
         steps {
             sh "git clone https://github.com/jabedhasan21/java-hello-world-with-maven.git"
             sh "/usr/local/bin/mvn install java-hello-world-with-maven"
             sh "/usr/local/bin/docker build -t tommyhaggerty/tommyhaggerty:${env.BUILD_ID} ."
         }
      }
      stage('Deploy') {
          steps {
            sh "BUILD_ID=${env.BUILD_ID} /usr/local/bin/docker stack deploy -c docker-compose.yml test"
          }
      }
   }
}